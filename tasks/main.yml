
---
# tasks file for fubarhouse.jenkinsjobs

- name: Jenkins Jobs | Clone/update repository
  git:
    repo: "{{ jenkins_repository }}"
    dest: "{{ jenkins_tempdir }}"
    clone: yes
    update: yes
    force: no

- name: Jenkins Jobs | Remove configured jobs
  file:
    path: "{{ jenkins_jobs_directory }}/{{ item.folder }}"
    state: touch
  with_items:
    - "{{ jenkins_jobs }}"
  when: item.state == "absent"

- name: Jenkins Jobs | Create directories for jobs
  file:
    path: "{{ jenkins_jobs_directory }}/{{ item.folder }}"
    state: directory
  with_items:
    - "{{ jenkins_jobs }}"
  when: item.state == "present"

- name: Jenkins Jobs | Copy configured jobs
  copy:
    src: "{{ jenkins_tempdir }}/{{ item.0.folder }}/{{ item.1 }}"
    dest: "{{ jenkins_jobs_directory }}/{{ item.0.folder }}/{{ item.1 }}"
  with_subelements:
    - jenkins_jobs
    - files
  when: item.0.state == "present"
